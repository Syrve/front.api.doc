---
title: Отмена процесса оплаты
layout: default
---

Начиная с API V8 появилась возможность прерывать оплату / сторнирование заказа, внесение / возврат предоплаты.

После проведения оплат в платежной системе (если таковая поддерживается типом оплаты) перед началом фискализации на фискальном регистраторе в API срабатывает уведомление
[`BeforeDoCheque`](https://iiko.github.io/front.api.sdk/v8/html/P_Resto_Front_Api_INotificationService_BeforeDoCheque.htm).
Раньше оно позволяло менять заказ через
[`IOperationService`](https://iiko.github.io/front.api.sdk/v8/html/T_Resto_Front_Api_IOperationService.htm),
доступный в аргументах уведомления, например, добавлять какие-либо внешние данные
([`AddOrderExternalData`](https://iiko.github.io/front.api.sdk/v8/html/M_Resto_Front_Api_Editors_IEditSession_AddOrderExternalData.htm)).
Также оно позволяло взаимодействовать с пользователем через
[`IViewManager`](https://iiko.github.io/front.api.sdk/v7/html/T_Resto_Front_Api_UI_IViewManager.htm),
показывать различные окна в iikoFront в случае, если оплата выполнялась не в фоне.

Теперь ко всему прочему добавилась возможность отменять процесс оплаты путем генерации исключения `OperationCanceledException` в соответствующем подписчике.
Это может быть востребовано в случаях, когда проверяются дополнительные условия,
невыполнение которых может препятствовать закрытию / сторнированию заказа или внесению / возврату предоплаты.

Также, в аргументах уведомления появился список оплат, над которыми конкретно сейчас происходит операция и для которых должен напечататься чек.

Уведомление генерируется как для фискальных, так и для нефискальных типов оплат.
